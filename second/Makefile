.PHONY: help up down logs status test-acl clean

help: ## –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É
	@echo "–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "\033[36m%-15s\033[0m %s\n", $$1, $$2}'

up: ## –ó–∞–ø—É—Å—Ç–∏—Ç—å Kafka –∫–ª–∞—Å—Ç–µ—Ä
	@echo "üöÄ –ó–∞–ø—É—Å–∫ Kafka –∫–ª–∞—Å—Ç–µ—Ä–∞ —Å SSL –∏ ACL..."
	docker-compose up -d
	@echo "‚úÖ –ö–ª–∞—Å—Ç–µ—Ä –∑–∞–ø—É—â–µ–Ω!"
	@echo "üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ 'make logs' –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤"

down: ## –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–ª–∞—Å—Ç–µ—Ä
	@echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ Kafka –∫–ª–∞—Å—Ç–µ—Ä–∞..."
	docker-compose down
	@echo "‚úÖ –ö–ª–∞—Å—Ç–µ—Ä –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!"

logs: ## –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
	docker-compose logs -f

logs-setup: ## –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
	docker-compose logs kafka-setup

logs-app: ## –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏ Go –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
	docker-compose logs producer-consumer

status: ## –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
	@echo "üìä –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤:"
	docker-compose ps

test-acl: ## –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ACL
	@echo "üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è ACL..."
	docker-compose run --rm kafka-setup /setup/test-acl.sh

test-topics: ## –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ —Ç–æ–ø–∏–∫–æ–≤
	@echo "üìã –°–ø–∏—Å–æ–∫ —Ç–æ–ø–∏–∫–æ–≤:"
	docker-compose exec kafka-0 kafka-topics.sh \
		--bootstrap-server kafka-0:9093 \
		--command-config /bitnami/kafka/config/certs/client.properties \
		--list

test-acl-list: ## –ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ ACL
	@echo "üîí –ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ ACL:"
	docker-compose exec kafka-0 kafka-acls.sh \
		--bootstrap-server kafka-0:9093 \
		--command-config /bitnami/kafka/config/certs/client.properties \
		--list

restart: down up ## –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–ª–∞—Å—Ç–µ—Ä

clean: down ## –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (—É–¥–∞–ª–µ–Ω–∏–µ volumes)
	@echo "üßπ –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö..."
	docker-compose down -v
	docker system prune -f
	@echo "‚úÖ –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"

setup-only: ## –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞—Å—Ç—Ä–æ–π–∫—É —Ç–æ–ø–∏–∫–æ–≤ –∏ ACL
	docker-compose up kafka-setup

build: ## –°–æ–±—Ä–∞—Ç—å Go –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ
	@echo "üî® –°–±–æ—Ä–∫–∞ Go –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."
	go build -o main .
	@echo "‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–æ–±—Ä–∞–Ω–æ!"

help-ssl: ## –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ SSL –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
	@echo "üîê SSL –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:"
	@echo "  - –í—Å–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã"
	@echo "  - Keystore –ø–∞—Ä–æ–ª—å: kafka-password"
	@echo "  - Truststore –ø–∞—Ä–æ–ª—å: kafka-password"
	@echo "  - –í–∑–∞–∏–º–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –≤–∫–ª—é—á–µ–Ω–∞"

help-topics: ## –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–ø–∏–∫–∞—Ö
	@echo "üìö –ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Ç–æ–ø–∏–∫–∏:"
	@echo "  - topic-1: –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø (R/W)"
	@echo "  - topic-2: —Ç–æ–ª—å–∫–æ –∑–∞–ø–∏—Å—å (W)"
	@echo "  - test: –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"
